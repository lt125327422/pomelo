<div id="mikan">
    <p>
    <div style="page-break-after:always"></div>
    <br/><br/><br/></p><a name="x1-1000" id="x1-1000"><h2 class="chapter_name"><i>Contents</i></h2></a> <a name="TOC"
                                                                                                           id="TOC"></a>
    <p class="toc_chapter"> <a name="QQ2-1-2" id="QQ2-1-2" href="part0000.xhtml#x1-2000">Preface</a></p>
    <p class="toc_part"> I: Kernels and Processes</p>
    <p class="toc_chapter">1. Introduction</p>
    <p class="toc_chapter">2. The
        Kernel Abstraction</p>
    <p class="toc_chapter">3. The Programming Interface</p>
    <p class="toc_part"> II: Concurrency</p>
    <p class="toc_chapter">4.
        Concurrency and Threads</p>
    <p class="toc_chapter">5. Synchronizing Access to Shared Objects</p>
    <p class="toc_chapter">6.
        Multi-Object Synchronization</p>
    <p class="toc_chapter">7. Scheduling</p>
    <p class="toc_part"> III: Memory Management</p>
    <p class="toc_chapter">8.
        Address Translation</p>
    <p class="toc_chapter">9. Caching and Virtual Memory</p>
    <p class="toc_chapter">10. Advanced Memory
        Management</p>
    <p class="toc_part">IV <a name="QQ2-1-28" id="QQ2-1-28" href="part0000.xhtml#x1-9000IV">Persistent Storage</a></p>
    <p class="toc_chapter">11 <a name="QQ2-1-29" id="QQ2-1-29" href="part0000.xhtml#x1-1000011">File Systems:
        Introduction and Overview</a></p>
    <p class="toc_section">11.1 <a name="QQ2-1-31" id="QQ2-1-31" href="part0000.xhtml#x1-110001">The
        File System Abstraction</a></p>
    <p class="toc_section">11.2 <a name="QQ2-1-36" id="QQ2-1-36" href="part0000.xhtml#x1-120002">API</a></p>
    <p class="toc_section">11.3 <a name="QQ2-1-38" id="QQ2-1-38" href="part0000.xhtml#x1-130003">Software Layers</a></p>
          11.3.1 <a name="QQ2-1-40" id="QQ2-1-40" href="part0000.xhtml#x1-140001">API and
    Performance</a><br/>      11.3.2 <a name="QQ2-1-41" id="QQ2-1-41" href="part0000.xhtml#x1-150002">Device Drivers:
    Common Abstractions</a><br/>      11.3.3 <a name="QQ2-1-42" id="QQ2-1-42" href="part0000.xhtml#x1-160003">Device
    Access</a><br/>      11.3.4 <a name="QQ2-1-45" id="QQ2-1-45" href="part0000.xhtml#x1-170004">Putting It All
    Together: A Simple Disk Request</a><br/>
    <p class="toc_section">11.4 <a name="QQ2-1-46" id="QQ2-1-46" href="part0000.xhtml#x1-180004">Summary and
        Future Directions</a></p>
    <p class="toc_section"> <a href="part0000.xhtml#Q1-1-47">Exercises</a></p>
    <p class="toc_chapter">12 <a name="QQ2-1-50" id="QQ2-1-50" href="part0000.xhtml#x1-2000012">Storage Devices</a></p>
    <p class="toc_section">12.1 <a name="QQ2-1-51" id="QQ2-1-51" href="part0000.xhtml#x1-210001">Magnetic Disk</a></p>
          12.1.1 <a name="QQ2-1-54" id="QQ2-1-54" href="part0000.xhtml#x1-220001">Disk
    Access and Performance</a><br/>      12.1.2 <a name="QQ2-1-55" id="QQ2-1-55" href="part0000.xhtml#x1-230002">Case
    Study: Toshiba MK3254GSY</a><br/>      12.1.3 <a name="QQ2-1-57" id="QQ2-1-57" href="part0000.xhtml#x1-240003">Disk
    Scheduling</a><br/>
    <p class="toc_section">12.2 <a name="QQ2-1-59" id="QQ2-1-59" href="part0000.xhtml#x1-250002">Flash Storage</a></p>
    <p class="toc_section">12.3 <a name="QQ2-1-62" id="QQ2-1-62" href="part0000.xhtml#x1-260003">Summary and Future
        Directions</a></p>
    <p class="toc_section"> <a href="part0000.xhtml#Q1-1-65">Exercises</a></p>
    <p class="toc_chapter">13 <a name="QQ2-1-70" id="QQ2-1-70" href="part0000.xhtml#x1-2800013">Files
        and Directories</a></p>
    <p class="toc_section">13.1 <a name="QQ2-1-71" id="QQ2-1-71" href="part0000.xhtml#x1-290001">Implementation
        Overview</a></p>
    <p class="toc_section">13.2 <a name="QQ2-1-73" id="QQ2-1-73" href="part0000.xhtml#x1-300002">Directories: Naming
        Data</a></p>
    <p class="toc_section">13.3 <a name="QQ2-1-80" id="QQ2-1-80" href="part0000.xhtml#x1-310003">Files: Finding Data</a>
    </p>      13.3.1 <a name="QQ2-1-82" id="QQ2-1-82" href="part0000.xhtml#x1-320001">FAT: Linked List</a><br/>      13.3.2 <a
        name="QQ2-1-84" id="QQ2-1-84" href="part0000.xhtml#x1-330002">FFS: Fixed
    Tree</a><br/>      13.3.3 <a name="QQ2-1-90" id="QQ2-1-90" href="part0000.xhtml#x1-340003">NTFS: Flexible Tree With
    Extents</a><br/>      13.3.4 <a name="QQ2-1-95" id="QQ2-1-95" href="part0000.xhtml#x1-350004">Copy-On-Write
    File Systems</a><br/>
    <p class="toc_section">13.4 <a name="QQ2-1-102" id="QQ2-1-102" href="part0000.xhtml#x1-360004">Putting It All
        Together: File and Directory Access</a></p>
    <p class="toc_section">13.5 <a name="QQ2-1-104" id="QQ2-1-104" href="part0000.xhtml#x1-370005">Summary
        and Future Directions</a></p>
    <p class="toc_section"> <a href="part0000.xhtml#Q1-1-105">Exercises</a></p>
    <p class="toc_chapter">14 <a name="QQ2-1-108" id="QQ2-1-108" href="part0000.xhtml#x1-3900014">Reliable Storage</a>
    </p>
    <p class="toc_section">14.1 <a name="QQ2-1-110" id="QQ2-1-110" href="part0000.xhtml#x1-400001">Transactions: Atomic
        Updates</a></p>      14.1.1 <a name="QQ2-1-111" id="QQ2-1-111" href="part0000.xhtml#x1-410001">Ad Hoc
    Approaches</a><br/>      14.1.2 <a name="QQ2-1-112" id="QQ2-1-112" href="part0000.xhtml#x1-420002">The Transaction
    Abstraction</a><br/>      14.1.3 <a name="QQ2-1-114" id="QQ2-1-114" href="part0000.xhtml#x1-430003">Implementing
    Transactions</a><br/>      14.1.4 <a name="QQ2-1-118" id="QQ2-1-118" href="part0000.xhtml#x1-450004">Transactions
    and File Systems</a><br/>
    <p class="toc_section">14.2 <a name="QQ2-1-121" id="QQ2-1-121" href="part0000.xhtml#x1-460002">Error Detection and
        Correction</a></p>      14.2.1 <a name="QQ2-1-122" id="QQ2-1-122" href="part0000.xhtml#x1-470001">Storage
    Device Failures and Mitigation</a><br/>      14.2.2 <a name="QQ2-1-126" id="QQ2-1-126"
                                                           href="part0000.xhtml#x1-500002">RAID: Multi-Disk Redundancy
    for Error Correction</a><br/>      14.2.3 <a name="QQ2-1-133" id="QQ2-1-133" href="part0000.xhtml#x1-550003">Software
    Integrity Checks</a><br/>
    <p class="toc_section">14.3 <a name="QQ2-1-136" id="QQ2-1-136" href="part0000.xhtml#x1-560003">Summary
        and Future Directions</a></p>
    <p class="toc_section"> <a href="part0000.xhtml#Q1-1-137">Exercises</a></p>
    <p class="toc_chapter"> <a name="QQ2-1-143" id="QQ2-1-143" href="part0000.xhtml#x1-580003">References</a></p>
    <p class="toc_chapter"> <a name="QQ2-1-144" id="QQ2-1-144" href="part0000.xhtml#x1-590003">Glossary</a></p>
    <p class="toc_chapter"> <a name="QQ2-1-145" id="QQ2-1-145" href="part0000.xhtml#x1-600003">About the Authors</a></p>


</div>
<script>

    /**
     * @param node {Element}
     * @param tagNames {string[]}
     */
    const getDirectChildByTagName = (node, tagNames) => {
        return Array.from(node.children).filter(element => tagNames.includes(element.tagName))
    }


    const getPropsOfA = (aEl) => {
        const id = aEl.getAttribute("id")
        const href = aEl.getAttribute("href")
        const label = aEl.textContent.trim();

        return {
            id,
            href,
            label
        }
    }


    class NavNode {
        constructor({label = null, href = null, id = null}) {
            this.label = label
            this.link = href
            this.id = id

            /**
             * @type {NavNode[]}
             */
            this.children = []
        }
    }

    /**
     * @param nodes {NavNode []}
     * @return {string}
     */
    const codeGen = (nodes) => {
        const res = [];

        for (const node of nodes) {
            res.push(`<navPoint id="${node.id}" playOrder="${node.id}">
                <navLabel>
                <text>${node.label}</text>
                </navLabel>
                <content src="Text/${node.link}"/>
                ${codeGen(node.children)}
            </navPoint>`)
        }

        return res.join("\n")
    }


    /**
     * @param elements {Element[]}
     */
    const parse = (elements) => {
        /**
         * @type {NavNode}
         */
        let currentP = null

        /**
         * @type {NavNode[]}
         */
        const nodes = [];

        while (elements.length > 0) {
            const head = elements.shift();
            switch (head.tagName) {
                case "P":
                    const a = Array.from(head.childNodes).find(node => node.tagName === "A");
                    if (a != null) {
                        nodes.push(currentP = new NavNode(getPropsOfA(a)))
                    }
                    break;
                case "A":
                    if (currentP != null) {
                        // console.log("a", head,)
                        currentP.children.push(new NavNode(getPropsOfA(head)))
                    }
                    break;
                default:
                    console.log(`Unexpected Tag <${head.tagName}>`)
            }
        }

        return nodes
    }


    const main = () => {
        const elements = getDirectChildByTagName(document.getElementById("mikan"), ["P", "A"]);

        const nodes = parse(elements)

        const code = codeGen(nodes);

        console.log(code)
    }

    main()

</script>